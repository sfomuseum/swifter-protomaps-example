var protomaps=(()=>{var Ht=Object.create;var he=Object.defineProperty;var Qt=Object.getOwnPropertyDescriptor;var Jt=Object.getOwnPropertyNames;var Kt=Object.getPrototypeOf,ei=Object.prototype.hasOwnProperty;var ti=(t,e,i)=>e in t?he(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Ke=t=>he(t,"__esModule",{value:!0});var I=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ii=(t,e)=>{Ke(t);for(var i in e)he(t,i,{get:e[i],enumerable:!0})},ri=(t,e,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Jt(e))!ei.call(t,r)&&r!=="default"&&he(t,r,{get:()=>e[r],enumerable:!(i=Qt(e,r))||i.enumerable});return t},X=t=>ri(Ke(he(t!=null?Ht(Kt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var K=(t,e,i)=>(ti(t,typeof e!="symbol"?e+"":e,i),i);var D=(t,e,i)=>new Promise((r,s)=>{var n=o=>{try{l(i.next(o))}catch(u){s(u)}},a=o=>{try{l(i.throw(o))}catch(u){s(u)}},l=o=>o.done?r(o.value):Promise.resolve(o.value).then(n,a);l((i=i.apply(t,e)).next())});var q=I((Hi,et)=>{"use strict";et.exports=ee;function ee(t,e){this.x=t,this.y=e}ee.prototype={clone:function(){return new ee(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,s=i*this.x+e*this.y;return this.x=r,this.y=s,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),s=e.x+i*(this.x-e.x)-r*(this.y-e.y),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=s,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};ee.convert=function(t){return t instanceof ee?t:Array.isArray(t)?new ee(t[0],t[1]):t}});var Re=I((Qi,tt)=>{"use strict";var ni=q();tt.exports=te;function te(t,e,i,r,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=s,t.readFields(si,this,e)}function si(t,e,i){t==1?e.id=i.readVarint():t==2?ai(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function ai(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[r]=s}}te.types=["Unknown","Point","LineString","Polygon"];te.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,n=0,a=[],l;t.pos<e;){if(r<=0){var o=t.readVarint();i=o&7,r=o>>3}if(r--,i===1||i===2)s+=t.readSVarint(),n+=t.readSVarint(),i===1&&(l&&a.push(l),l=[]),l.push(new ni(s,n));else if(i===7)l&&l.push(l[0].clone());else throw new Error("unknown command "+i)}return l&&a.push(l),a};te.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,n=0,a=Infinity,l=-Infinity,o=Infinity,u=-Infinity;t.pos<e;){if(r<=0){var d=t.readVarint();i=d&7,r=d>>3}if(r--,i===1||i===2)s+=t.readSVarint(),n+=t.readSVarint(),s<a&&(a=s),s>l&&(l=s),n<o&&(o=n),n>u&&(u=n);else if(i!==7)throw new Error("unknown command "+i)}return[a,o,l,u]};te.prototype.toGeoJSON=function(t,e,i){var r=this.extent*Math.pow(2,i),s=this.extent*t,n=this.extent*e,a=this.loadGeometry(),l=te.types[this.type],o,u;function d(p){for(var b=0;b<p.length;b++){var g=p[b],h=180-(g.y+n)*360/r;p[b]=[(g.x+s)*360/r-180,360/Math.PI*Math.atan(Math.exp(h*Math.PI/180))-90]}}switch(this.type){case 1:var x=[];for(o=0;o<a.length;o++)x[o]=a[o][0];a=x,d(a);break;case 2:for(o=0;o<a.length;o++)d(a[o]);break;case 3:for(a=li(a),o=0;o<a.length;o++)for(u=0;u<a[o].length;u++)d(a[o][u]);break}a.length===1?a=a[0]:l="Multi"+l;var m={type:"Feature",geometry:{type:l,coordinates:a},properties:this.properties};return"id"in this&&(m.id=this.id),m};function li(t){var e=t.length;if(e<=1)return[t];for(var i=[],r,s,n=0;n<e;n++){var a=oi(t[n]);a!==0&&(s===void 0&&(s=a<0),s===a<0?(r&&i.push(r),r=[t[n]]):r.push(t[n]))}return r&&i.push(r),i}function oi(t){for(var e=0,i=0,r=t.length,s=r-1,n,a;i<r;s=i++)n=t[i],a=t[s],e+=(a.x-n.x)*(n.y+a.y);return e}});var Ve=I((Ji,rt)=>{"use strict";var hi=Re();rt.exports=it;function it(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ui,this,e),this.length=this._features.length}function ui(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(fi(i))}function fi(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=r===1?t.readString():r===2?t.readFloat():r===3?t.readDouble():r===4?t.readVarint64():r===5?t.readVarint():r===6?t.readSVarint():r===7?t.readBoolean():null}return e}it.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new hi(this._pbf,e,this.extent,this._keys,this._values)}});var st=I((Ki,nt)=>{"use strict";var di=Ve();nt.exports=ci;function ci(t,e){this.layers=t.readFields(mi,{},e)}function mi(t,e,i){if(t===3){var r=new di(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}});var at=I((er,be)=>{be.exports.VectorTile=st();be.exports.VectorTileFeature=Re();be.exports.VectorTileLayer=Ve()});var lt=I(Ie=>{Ie.read=function(t,e,i,r,s){var n,a,l=s*8-r-1,o=(1<<l)-1,u=o>>1,d=-7,x=i?s-1:0,m=i?-1:1,p=t[e+x];for(x+=m,n=p&(1<<-d)-1,p>>=-d,d+=l;d>0;n=n*256+t[e+x],x+=m,d-=8);for(a=n&(1<<-d)-1,n>>=-d,d+=r;d>0;a=a*256+t[e+x],x+=m,d-=8);if(n===0)n=1-u;else{if(n===o)return a?NaN:(p?-1:1)*Infinity;a=a+Math.pow(2,r),n=n-u}return(p?-1:1)*a*Math.pow(2,n-r)};Ie.write=function(t,e,i,r,s,n){var a,l,o,u=n*8-s-1,d=(1<<u)-1,x=d>>1,m=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:n-1,b=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===Infinity?(l=isNaN(e)?1:0,a=d):(a=Math.floor(Math.log(e)/Math.LN2),e*(o=Math.pow(2,-a))<1&&(a--,o*=2),a+x>=1?e+=m/o:e+=m*Math.pow(2,1-x),e*o>=2&&(a++,o/=2),a+x>=d?(l=0,a=d):a+x>=1?(l=(e*o-1)*Math.pow(2,s),a=a+x):(l=e*Math.pow(2,x-1)*Math.pow(2,s),a=0));s>=8;t[i+p]=l&255,p+=b,l/=256,s-=8);for(a=a<<s|l,u+=s;u>0;t[i+p]=a&255,p+=b,a/=256,u-=8);t[i+p-b]|=g*128}});var ct=I((ir,dt)=>{"use strict";dt.exports=k;var ge=lt();function k(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}k.Varint=0;k.Fixed64=1;k.Bytes=2;k.Fixed32=5;var Xe=(1<<16)*(1<<16),ot=1/Xe,xi=12,ht=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");k.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=r&7,t(s,e,this),this.pos===n&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=we(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ft(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=we(this.buf,this.pos)+we(this.buf,this.pos+4)*Xe;return this.pos+=8,t},readSFixed64:function(){var t=we(this.buf,this.pos)+ft(this.buf,this.pos+4)*Xe;return this.pos+=8,t},readFloat:function(){var t=ge.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ge.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,i,r;return r=e[this.pos++],i=r&127,r<128||(r=e[this.pos++],i|=(r&127)<<7,r<128)||(r=e[this.pos++],i|=(r&127)<<14,r<128)||(r=e[this.pos++],i|=(r&127)<<21,r<128)?i:(r=e[this.pos],i|=(r&15)<<28,pi(i,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=xi&&ht?Bi(this.buf,e,t):Ti(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==k.Bytes)return t.push(this.readVarint(e));var i=E(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==k.Bytes)return t.push(this.readSVarint());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==k.Bytes)return t.push(this.readBoolean());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==k.Bytes)return t.push(this.readFloat());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==k.Bytes)return t.push(this.readDouble());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==k.Bytes)return t.push(this.readFixed32());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==k.Bytes)return t.push(this.readSFixed32());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==k.Bytes)return t.push(this.readFixed64());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==k.Bytes)return t.push(this.readSFixed64());var e=E(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===k.Varint)for(;this.buf[this.pos++]>127;);else if(e===k.Bytes)this.pos=this.readVarint()+this.pos;else if(e===k.Fixed32)this.pos+=4;else if(e===k.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),re(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),re(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),re(this.buf,t&-1,this.pos),re(this.buf,Math.floor(t*ot),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),re(this.buf,t&-1,this.pos),re(this.buf,Math.floor(t*ot),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){yi(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=Pi(this.buf,t,this.pos);var i=this.pos-e;i>=128&&ut(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ge.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ge.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&ut(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,k.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,wi,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,vi,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Mi,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Fi,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,_i,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Si,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Li,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ki,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,zi,e)},writeBytesField:function(t,e){this.writeTag(t,k.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,k.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,k.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,k.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,k.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,k.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,k.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,k.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,k.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,k.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function pi(t,e,i){var r=i.buf,s,n;if(n=r[i.pos++],s=(n&112)>>4,n<128||(n=r[i.pos++],s|=(n&127)<<3,n<128)||(n=r[i.pos++],s|=(n&127)<<10,n<128)||(n=r[i.pos++],s|=(n&127)<<17,n<128)||(n=r[i.pos++],s|=(n&127)<<24,n<128)||(n=r[i.pos++],s|=(n&1)<<31,n<128))return ie(t,s,e);throw new Error("Expected varint not more than 10 bytes")}function E(t){return t.type===k.Bytes?t.readVarint()+t.pos:t.pos+1}function ie(t,e,i){return i?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function yi(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(i=~(-t%4294967296),r=~(-t/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),bi(i,r,e),gi(r,e)}function bi(t,e,i){i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos++]=t&127|128,t>>>=7,i.buf[i.pos]=t&127}function gi(t,e){var i=(t&7)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),!!t&&(e.buf[e.pos++]=t&127)))))}function ut(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));i.realloc(r);for(var s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function wi(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function vi(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Fi(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function _i(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Mi(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Si(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Li(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function ki(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function zi(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function we(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function re(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function ft(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Ti(t,e,i){for(var r="",s=e;s<i;){var n=t[s],a=null,l=n>239?4:n>223?3:n>191?2:1;if(s+l>i)break;var o,u,d;l===1?n<128&&(a=n):l===2?(o=t[s+1],(o&192)==128&&(a=(n&31)<<6|o&63,a<=127&&(a=null))):l===3?(o=t[s+1],u=t[s+2],(o&192)==128&&(u&192)==128&&(a=(n&15)<<12|(o&63)<<6|u&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):l===4&&(o=t[s+1],u=t[s+2],d=t[s+3],(o&192)==128&&(u&192)==128&&(d&192)==128&&(a=(n&15)<<18|(o&63)<<12|(u&63)<<6|d&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,l=1):a>65535&&(a-=65536,r+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),r+=String.fromCharCode(a),s+=l}return r}function Bi(t,e,i){return ht.decode(t.subarray(e,i))}function Pi(t,e,i){for(var r=0,s,n;r<e.length;r++){if(s=e.charCodeAt(r),s>55295&&s<57344)if(n)if(s<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=s;continue}else s=n-55296<<10|s-56320|65536,n=null;else{s>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=s;continue}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);s<128?t[i++]=s:(s<2048?t[i++]=s>>6|192:(s<65536?t[i++]=s>>12|224:(t[i++]=s>>18|240,t[i++]=s>>12&63|128),t[i++]=s>>6&63|128),t[i++]=s&63|128)}return i}});var Ft=I((Ee,Ae)=>{(function(t,e){typeof Ee=="object"&&typeof Ae!="undefined"?Ae.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(Ee,function(){"use strict";function t(h,f,c,w,y){(function v(F,_,M,S,T){for(;S>M;){if(S-M>600){var z=S-M+1,P=_-M+1,le=Math.log(z),Z=.5*Math.exp(2*le/3),Q=.5*Math.sqrt(le*Z*(z-Z)/z)*(P-z/2<0?-1:1),J=Math.max(M,Math.floor(_-P*Z/z+Q)),Gt=Math.min(S,Math.floor(_+(z-P)*Z/z+Q));v(F,_,J,Gt,T)}var ye=F[_],oe=M,V=S;for(e(F,M,_),T(F[S],ye)>0&&e(F,M,S);oe<V;){for(e(F,oe,V),oe++,V--;T(F[oe],ye)<0;)oe++;for(;T(F[V],ye)>0;)V--}T(F[M],ye)===0?e(F,M,V):e(F,++V,S),V<=_&&(M=V+1),_<=V&&(S=V-1)}})(h,f,c||0,w||h.length-1,y||i)}function e(h,f,c){var w=h[f];h[f]=h[c],h[c]=w}function i(h,f){return h<f?-1:h>f?1:0}var r=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(h,f,c){if(!c)return f.indexOf(h);for(var w=0;w<f.length;w++)if(c(h,f[w]))return w;return-1}function n(h,f){a(h,0,h.children.length,f,h)}function a(h,f,c,w,y){y||(y=b(null)),y.minX=1/0,y.minY=1/0,y.maxX=-1/0,y.maxY=-1/0;for(var v=f;v<c;v++){var F=h.children[v];l(y,h.leaf?w(F):F)}return y}function l(h,f){return h.minX=Math.min(h.minX,f.minX),h.minY=Math.min(h.minY,f.minY),h.maxX=Math.max(h.maxX,f.maxX),h.maxY=Math.max(h.maxY,f.maxY),h}function o(h,f){return h.minX-f.minX}function u(h,f){return h.minY-f.minY}function d(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function x(h){return h.maxX-h.minX+(h.maxY-h.minY)}function m(h,f){return h.minX<=f.minX&&h.minY<=f.minY&&f.maxX<=h.maxX&&f.maxY<=h.maxY}function p(h,f){return f.minX<=h.maxX&&f.minY<=h.maxY&&f.maxX>=h.minX&&f.maxY>=h.minY}function b(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(h,f,c,w,y){for(var v=[f,c];v.length;)if(!((c=v.pop())-(f=v.pop())<=w)){var F=f+Math.ceil((c-f)/w/2)*w;t(h,F,f,c,y),v.push(f,F,F,c)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(h){var f=this.data,c=[];if(!p(h,f))return c;for(var w=this.toBBox,y=[];f;){for(var v=0;v<f.children.length;v++){var F=f.children[v],_=f.leaf?w(F):F;p(h,_)&&(f.leaf?c.push(F):m(h,_)?this._all(F,c):y.push(F))}f=y.pop()}return c},r.prototype.collides=function(h){var f=this.data;if(!p(h,f))return!1;for(var c=[];f;){for(var w=0;w<f.children.length;w++){var y=f.children[w],v=f.leaf?this.toBBox(y):y;if(p(h,v)){if(f.leaf||m(h,v))return!0;c.push(y)}}f=c.pop()}return!1},r.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var f=0;f<h.length;f++)this.insert(h[f]);return this}var c=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===c.height)this._splitRoot(this.data,c);else{if(this.data.height<c.height){var w=this.data;this.data=c,c=w}this._insert(c,this.data.height-c.height-1,!0)}else this.data=c;return this},r.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},r.prototype.clear=function(){return this.data=b([]),this},r.prototype.remove=function(h,f){if(!h)return this;for(var c,w,y,v=this.data,F=this.toBBox(h),_=[],M=[];v||_.length;){if(v||(v=_.pop(),w=_[_.length-1],c=M.pop(),y=!0),v.leaf){var S=s(h,v.children,f);if(S!==-1)return v.children.splice(S,1),_.push(v),this._condense(_),this}y||v.leaf||!m(v,F)?w?(c++,v=w.children[c],y=!1):v=null:(_.push(v),M.push(c),c=0,w=v,v=v.children[0])}return this},r.prototype.toBBox=function(h){return h},r.prototype.compareMinX=function(h,f){return h.minX-f.minX},r.prototype.compareMinY=function(h,f){return h.minY-f.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(h){return this.data=h,this},r.prototype._all=function(h,f){for(var c=[];h;)h.leaf?f.push.apply(f,h.children):c.push.apply(c,h.children),h=c.pop();return f},r.prototype._build=function(h,f,c,w){var y,v=c-f+1,F=this._maxEntries;if(v<=F)return n(y=b(h.slice(f,c+1)),this.toBBox),y;w||(w=Math.ceil(Math.log(v)/Math.log(F)),F=Math.ceil(v/Math.pow(F,w-1))),(y=b([])).leaf=!1,y.height=w;var _=Math.ceil(v/F),M=_*Math.ceil(Math.sqrt(F));g(h,f,c,M,this.compareMinX);for(var S=f;S<=c;S+=M){var T=Math.min(S+M-1,c);g(h,S,T,_,this.compareMinY);for(var z=S;z<=T;z+=_){var P=Math.min(z+_-1,T);y.children.push(this._build(h,z,P,w-1))}}return n(y,this.toBBox),y},r.prototype._chooseSubtree=function(h,f,c,w){for(;w.push(f),!f.leaf&&w.length-1!==c;){for(var y=1/0,v=1/0,F=void 0,_=0;_<f.children.length;_++){var M=f.children[_],S=d(M),T=(z=h,P=M,(Math.max(P.maxX,z.maxX)-Math.min(P.minX,z.minX))*(Math.max(P.maxY,z.maxY)-Math.min(P.minY,z.minY))-S);T<v?(v=T,y=S<y?S:y,F=M):T===v&&S<y&&(y=S,F=M)}f=F||f.children[0]}var z,P;return f},r.prototype._insert=function(h,f,c){var w=c?h:this.toBBox(h),y=[],v=this._chooseSubtree(w,this.data,f,y);for(v.children.push(h),l(v,w);f>=0&&y[f].children.length>this._maxEntries;)this._split(y,f),f--;this._adjustParentBBoxes(w,y,f)},r.prototype._split=function(h,f){var c=h[f],w=c.children.length,y=this._minEntries;this._chooseSplitAxis(c,y,w);var v=this._chooseSplitIndex(c,y,w),F=b(c.children.splice(v,c.children.length-v));F.height=c.height,F.leaf=c.leaf,n(c,this.toBBox),n(F,this.toBBox),f?h[f-1].children.push(F):this._splitRoot(c,F)},r.prototype._splitRoot=function(h,f){this.data=b([h,f]),this.data.height=h.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(h,f,c){for(var w,y,v,F,_,M,S,T=1/0,z=1/0,P=f;P<=c-f;P++){var le=a(h,0,P,this.toBBox),Z=a(h,P,c,this.toBBox),Q=(y=le,v=Z,F=void 0,_=void 0,M=void 0,S=void 0,F=Math.max(y.minX,v.minX),_=Math.max(y.minY,v.minY),M=Math.min(y.maxX,v.maxX),S=Math.min(y.maxY,v.maxY),Math.max(0,M-F)*Math.max(0,S-_)),J=d(le)+d(Z);Q<T?(T=Q,w=P,z=J<z?J:z):Q===T&&J<z&&(z=J,w=P)}return w||c-f},r.prototype._chooseSplitAxis=function(h,f,c){var w=h.leaf?this.compareMinX:o,y=h.leaf?this.compareMinY:u;this._allDistMargin(h,f,c,w)<this._allDistMargin(h,f,c,y)&&h.children.sort(w)},r.prototype._allDistMargin=function(h,f,c,w){h.children.sort(w);for(var y=this.toBBox,v=a(h,0,f,y),F=a(h,c-f,c,y),_=x(v)+x(F),M=f;M<c-f;M++){var S=h.children[M];l(v,h.leaf?y(S):S),_+=x(v)}for(var T=c-f-1;T>=f;T--){var z=h.children[T];l(F,h.leaf?y(z):z),_+=x(F)}return _},r.prototype._adjustParentBBoxes=function(h,f,c){for(var w=c;w>=0;w--)l(f[w],h)},r.prototype._condense=function(h){for(var f=h.length-1,c=void 0;f>=0;f--)h[f].children.length===0?f>0?(c=h[f-1].children).splice(c.indexOf(h[f]),1):this.clear():n(h[f],this.toBBox)},r})});var St=I((qe,Ue)=>{(function(t,e){typeof qe=="object"&&typeof Ue!="undefined"?Ue.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self,t.TinyQueue=e())})(qe,function(){"use strict";var t=function(r,s){if(r===void 0&&(r=[]),s===void 0&&(s=e),this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};t.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(r){for(var s=this,n=s.data,a=s.compare,l=n[r];r>0;){var o=r-1>>1,u=n[o];if(a(l,u)>=0)break;n[r]=u,r=o}n[r]=l},t.prototype._down=function(r){for(var s=this,n=s.data,a=s.compare,l=this.length>>1,o=n[r];r<l;){var u=(r<<1)+1,d=n[u],x=u+1;if(x<this.length&&a(n[x],d)<0&&(u=x,d=n[x]),a(d,o)>=0)break;n[r]=d,r=u}n[r]=o};function e(i,r){return i<r?-1:i>r?1:0}return t})});var kt=I((xr,Ze)=>{"use strict";var ke=St();ke.default&&(ke=ke.default);Ze.exports=Lt;Ze.exports.default=Lt;function Lt(t,e,i){e=e||1;for(var r,s,n,a,l=0;l<t[0].length;l++){var o=t[0][l];(!l||o[0]<r)&&(r=o[0]),(!l||o[1]<s)&&(s=o[1]),(!l||o[0]>n)&&(n=o[0]),(!l||o[1]>a)&&(a=o[1])}var u=n-r,d=a-s,x=Math.min(u,d),m=x/2;if(x===0){var p=[r,s];return p.distance=0,p}for(var b=new ke(void 0,Xi),g=r;g<n;g+=x)for(var h=s;h<a;h+=x)b.push(new U(g+m,h+m,m,t));var f=Ei(t),c=new U(r+u/2,s+d/2,0,t);c.d>f.d&&(f=c);for(var w=b.length;b.length;){var y=b.pop();y.d>f.d&&(f=y,i&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,w)),!(y.max-f.d<=e)&&(m=y.h/2,b.push(new U(y.x-m,y.y-m,m,t)),b.push(new U(y.x+m,y.y-m,m,t)),b.push(new U(y.x-m,y.y+m,m,t)),b.push(new U(y.x+m,y.y+m,m,t)),w+=4)}i&&(console.log("num probes: "+w),console.log("best distance: "+f.d));var v=[f.x,f.y];return v.distance=f.d,v}function Xi(t,e){return e.max-t.max}function U(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=Yi(t,e,r),this.max=this.d+this.h*Math.SQRT2}function Yi(t,e,i){for(var r=!1,s=Infinity,n=0;n<i.length;n++)for(var a=i[n],l=0,o=a.length,u=o-1;l<o;u=l++){var d=a[l],x=a[u];d[1]>e!=x[1]>e&&t<(x[0]-d[0])*(e-d[1])/(x[1]-d[1])+d[0]&&(r=!r),s=Math.min(s,Ai(t,e,d,x))}return s===0?0:(r?1:-1)*Math.sqrt(s)}function Ei(t){for(var e=0,i=0,r=0,s=t[0],n=0,a=s.length,l=a-1;n<a;l=n++){var o=s[n],u=s[l],d=o[0]*u[1]-u[0]*o[1];i+=(o[0]+u[0])*d,r+=(o[1]+u[1])*d,e+=d*3}return e===0?new U(s[0][0],s[0][1],0,t):new U(i/e,r/e,0,t)}function Ai(t,e,i,r){var s=i[0],n=i[1],a=r[0]-s,l=r[1]-n;if(a!==0||l!==0){var o=((t-s)*a+(e-n)*l)/(a*a+l*l);o>1?(s=r[0],n=r[1]):o>0&&(s+=a*o,n+=l*o)}return a=t-s,l=e-n,a*a+l*l}});var Tt=I((br,zt)=>{zt.exports=function(t,e){var i=[],r=[null],s,n,a,l=0,o=0,u=0,d=0,x=0,m=0,p=0,b=0,g=0,h=0,f=0,c=0;if(t.length<2)return[];if(t.length===2)return u=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),[{length:u,beginIndex:0,beginDistance:0,endIndex:2,endDistance:u,angles:[null,null]}];for(d=Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2)),l=1,o=t.length-1;l<o;l++)s=t[l-1],n=t[l],a=t[l+1],m=n.x-s.x,p=n.y-s.y,b=a.x-n.x,g=a.y-n.y,x=Math.sqrt(b*b+g*g),u+=d,h=Math.acos((m*b+p*g)/(d*x)),r.push(h),h>e&&(i.push({length:u-c,beginDistance:c,beginIndex:f,endIndex:l+1,endDistance:u,angles:r}),f=l,c=u,r=[h]),d=x;return r.push(null),l-f>0&&i.push({length:u-c+x,beginIndex:f,beginDistance:c,endIndex:l+1,endDistance:u+x,angles:r}),i}});var ji={};ii(ji,{CenteredTextSymbolizer:()=>Y,CircleSymbolizer:()=>ne,Font:()=>Nt,GroupSymbolizer:()=>se,IconSymbolizer:()=>Oe,LeafletLayer:()=>Ce,LineLabelSymbolizer:()=>G,LineSymbolizer:()=>C,OffsetTextSymbolizer:()=>ae,PMTiles:()=>ue,PolygonLabelSymbolizer:()=>H,PolygonSymbolizer:()=>B,Sprites:()=>jt,Static:()=>je,arr:()=>Vt,createPattern:()=>Rt,exp:()=>R,json_style:()=>Ot,leafletLayer:()=>qt});var Be=X(q());var ve=X(q()),yt=X(at()),bt=X(ct());var mt=(t,e)=>t*Math.pow(2,e),xt=(t,e)=>mt(t.getUint16(e+1,!0),8)+t.getUint8(e,!0),Ci=(t,e)=>mt(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),Di=t=>{var e=t.getUint16(0,!0),i=t.getUint16(2,!0),r=t.getUint32(4,!0),s=t.getUint16(8,!0);return{version:i,json_size:r,root_entries:s}},pt=t=>{let e=new Map;for(var i=0;i<t.byteLength;i+=17){var r=t.getUint8(i,!0),s=r&127,n=r>>7,a=xt(t,i+1),l=xt(t,i+4),o=Ci(t,i+7),u=t.getUint32(i+13,!0);e.set(s+"_"+a+"_"+l,[o,u,n])}return e},ue=class{constructor(e){K(this,"metadata",e=>new Promise((i,r)=>{this.root.then(s=>{i(s.metadata)})}));K(this,"getLeaf",(e,i)=>new Promise((r,s)=>{this.leaves.has(e)?(this.leaves.get(e)[0]++,r(this.leaves.get(e)[1])):this.outstanding_requests.has(e)?this.outstanding_requests.get(e).push(r):(this.outstanding_requests.set(e,[]),fetch(this.url,{headers:{Range:"bytes="+e+"-"+(e+i-1)}}).then(n=>n.arrayBuffer()).then(n=>{var a=pt(new DataView(n),i/17);if(this.leaves.size>32){var l=Infinity,o=void 0;this.leaves.forEach((u,d)=>{u[0]<l&&(l=u[0],o=d)}),this.leaves.delete(o)}this.leaves.set(e,[this.step++,a]),r(a),this.outstanding_requests.get(e).forEach(u=>u(a)),this.outstanding_requests.delete(e)}))}));K(this,"getZxy",(e,i,r)=>{var s=e+"_"+i+"_"+r;return this.root.then(n=>{if(n.dir.has(s)&&n.dir.get(s)[2]==0)return n.dir.get(s);if(e>=7){var a=e-7,l=[7,Math.trunc(i/(1<<a)),Math.trunc(r/(1<<a))],o=l[0]+"_"+l[1]+"_"+l[2];if(n.dir.has(o)&&n.dir.get(o)[2]==1){let u=n.dir.get(o);return this.getLeaf(u[0],u[1]).then(d=>d.has(s)?d.get(s):null)}}return null})});K(this,"transformRequest",(e,i,r,s)=>{if(e.endsWith(".pmtiles")&&s){var n=r.tileID.canonical,a=n.z+"_"+n.x+"_"+n.y;this.getZxy(n.z,n.x,n.y).then(l=>{l&&s({url:this.url,headers:{Range:"bytes="+l[0]+"-"+(l[0]+l[1]-1)}})})}return{url:e}});K(this,"leafletLayer",e=>{let i=this;var r=L.GridLayer.extend({createTile:function(s,n){var a=document.createElement("img"),l;return i.getZxy(s.z,s.x,s.y).then(o=>{o!==null&&fetch(i.url,{headers:{Range:"bytes="+o[0]+"-"+(o[0]+o[1]-1)}}).then(u=>u.arrayBuffer()).then(u=>{var d=new Blob([u],{type:"image/png"}),x=window.URL.createObjectURL(d);a.src=x,n(l,a)})}),a},_removeTile:function(s){var n=this._tiles[s];!n||(n.el.width=0,n.el.height=0,n.el.deleted=!0,L.DomUtil.remove(n.el),delete this._tiles[s],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(s)}))}});return new r(e)});this.url=e;let i=new AbortController,r=i.signal;this.root=fetch(this.url,{signal:r,headers:{Range:"bytes=0-511999"}}).then(s=>(s.headers.get("Content-Length")!=512e3&&(console.error("Content-Length mismatch indicates byte serving not supported; aborting."),i.abort()),s.arrayBuffer())).then(s=>{let n=Di(new DataView(s,0,10));var a=new TextDecoder("utf-8");return{metadata:JSON.parse(a.decode(new DataView(s,10,n.json_size))),dir:pt(new DataView(s,10+n.json_size,17*n.root_entries))}}),this.step=0,this.leaves=new Map,this.outstanding_requests=new Map}};var fe;(function(r){r[r.Point=1]="Point",r[r.Line=2]="Line",r[r.Polygon=3]="Polygon"})(fe||(fe={}));function W(t){return t.x+":"+t.y+":"+t.z}var Ri=(t,e,i)=>{t.pos=e;for(var r=t.readVarint()+t.pos,s=1,n=0,a=0,l=0,o=[],u,d=Infinity,x=-Infinity,m=Infinity,p=-Infinity;t.pos<r;){if(n<=0){var b=t.readVarint();s=b&7,n=b>>3}if(n--,s===1||s===2)a+=t.readSVarint()*i,l+=t.readSVarint()*i,a<d&&(d=a),a>x&&(x=a),l<m&&(m=l),l>p&&(p=l),s===1&&(u&&o.push(u),u=[]),u.push(new ve.default(a,l));else if(s===7)u&&u.push(u[0].clone());else throw new Error("unknown command "+s)}return u&&o.push(u),{geom:o,bbox:[d,m,x,p]}};function gt(t,e){let i=new yt.VectorTile(new bt.default(t)),r=new Map;for(let[s,n]of Object.entries(i.layers)){let a=[],l=n;for(let o=0;o<l.length;o++){let u=l.feature(o),d=Ri(u._pbf,u._geometry,e/l.extent),x=0;for(let m of d.geom)x+=m.length;a.push({geomType:l.feature(o).type,geom:d.geom,numVertices:x,bbox:d.bbox,properties:l.feature(o).properties})}r.set(s,a)}return r}var O=class{constructor(e){e.url?this.p=e:this.p=new ue(e),this.controllers=[]}get(e,i){return D(this,null,function*(){this.controllers=this.controllers.filter(a=>a[0]!=e.z?(a[1].abort(),!1):!0);let r=yield this.p.getZxy(e.z,e.x,e.y);if(!r)throw new Error(`Tile ${e.z} ${e.x} ${e.y} not found in archive`);let s=new AbortController;this.controllers.push([e.z,s]);let n=s.signal;return new Promise((a,l)=>{fetch(this.p.url,{headers:{Range:"bytes="+r[0]+"-"+(r[0]+r[1]-1)},signal:n}).then(o=>o.arrayBuffer()).then(o=>{let u=gt(o,i);a(u)}).catch(o=>{l(o)})})})}},de=class{constructor(e){this.url=e,this.controllers=[]}get(e,i){return D(this,null,function*(){this.controllers=this.controllers.filter(a=>a[0]!=e.z?(a[1].abort(),!1):!0);let r=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),s=new AbortController;this.controllers.push([e.z,s]);let n=s.signal;return new Promise((a,l)=>{fetch(r,{signal:n}).then(o=>o.arrayBuffer()).then(o=>{let u=gt(o,i);a(u)}).catch(o=>{l(o)})})})}},Ye=6378137,wt=85.0511287798,Fe=Ye*Math.PI,Vi=t=>{let e=Math.PI/180,i=Math.max(Math.min(wt,t[0]),-wt),r=Math.sin(i*e);return new ve.default(Ye*t[1]*e,Ye*Math.log((1+r)/(1-r))/2)},ce=class{constructor(e,i){this.source=e,this.cache=new Map,this.inflight=new Map,this.tileSize=i}queryFeatures(e,i,r){let s=Vi([i,e]),a=new ve.default((s.x+Fe)/(Fe*2),1-(s.y+Fe)/(Fe*2)).mult(1<<r),l=Math.floor(a.x),o=Math.floor(a.y),u=W({z:r,x:l,y:o}),d=[];if(this.cache.has(u)){let x=(a.x-l)*this.tileSize,m=(a.y-o)*this.tileSize,p=this.cache.get(u),b=[x-8,m-8,x+8,m+8];for(let[g,h]of p.data.entries())for(let f of h)b[2]>=f.bbox[0]&&f.bbox[2]>=b[0]&&b[3]>=f.bbox[3]&&f.bbox[3]>=b[1]&&d.push(f)}return d}get(e){return D(this,null,function*(){let i=W(e);return new Promise((r,s)=>{if(this.cache.has(i)){let n=this.cache.get(i);n.used=performance.now(),r(n.data)}else this.inflight.has(i)?this.inflight.get(i).push([r,s]):(this.inflight.set(i,[]),this.source.get(e,this.tileSize).then(n=>{if(this.cache.set(i,{used:performance.now(),data:n}),this.inflight.get(i).forEach(a=>a[0](n)),this.inflight.delete(i),r(n),this.cache.size>=64){let a=Infinity,l;this.cache.forEach((o,u)=>{o.used<a&&(l=u)}),this.cache.delete(l)}}).catch(n=>{this.inflight.get(i).forEach(a=>a[1](n)),this.inflight.delete(i),s(n)}))})})}};var $=X(q()),_e=(t,e,i)=>{let r=[];for(let s of t){let n=[];for(let a of s)n.push(a.clone().mult(e).add(i));r.push(n)}return r},me=class{constructor(e,i,r){this.tileCache=e,this.maxDataLevel=i,this.levelDiff=r}dataTilesForBounds(e,i){let r=[];var s=1,n=this.tileCache.tileSize;if(e<this.levelDiff)s=1/(1<<this.levelDiff-e),r.push({data_tile:{z:0,x:0,y:0},origin:new $.default(0,0),scale:s,dim:n*s});else if(e<=this.levelDiff+this.maxDataLevel){let o=1<<this.levelDiff,u=Math.floor(i[0]/o/256),d=Math.floor(i[1]/o/256),x=Math.floor(i[2]/o/256),m=Math.floor(i[3]/o/256);for(var a=u;a<=x;a++)for(var l=d;l<=m;l++){let p=new $.default(a*o*256,l*o*256);r.push({data_tile:{z:e-this.levelDiff,x:a,y:l},origin:p,scale:1,dim:n})}}else{let o=1<<this.levelDiff;s=1<<e-this.maxDataLevel-this.levelDiff;let u=Math.floor(i[0]/o/256/s),d=Math.floor(i[1]/o/256/s),x=Math.floor(i[2]/o/256/s),m=Math.floor(i[3]/o/256/s);for(var a=u;a<=x;a++)for(var l=d;l<=m;l++){let g=new $.default(a*o*256*s,l*o*256*s);r.push({data_tile:{z:this.maxDataLevel,x:a,y:l},origin:g,scale:s,dim:n*s})}}return r}dataTileForDisplayTile(e){var i,r=1,s=this.tileCache.tileSize,n;if(e.z<this.levelDiff)i={z:0,x:0,y:0},r=1/(1<<this.levelDiff-e.z),n=new $.default(0,0),s=s*r;else if(e.z<=this.levelDiff+this.maxDataLevel){let a=1<<this.levelDiff;i={z:e.z-this.levelDiff,x:Math.floor(e.x/a),y:Math.floor(e.y/a)},n=new $.default(i.x*a*256,i.y*a*256)}else{r=1<<e.z-this.maxDataLevel-this.levelDiff;let a=1<<this.levelDiff;i={z:this.maxDataLevel,x:Math.floor(e.x/a/r),y:Math.floor(e.y/a/r)},n=new $.default(i.x*a*r*256,i.y*a*r*256),s=s*r}return{data_tile:i,scale:r,origin:n,dim:s}}getBbox(e,i){return D(this,null,function*(){let r=this.dataTilesForBounds(e,i);return(yield Promise.all(r.map(n=>this.tileCache.get(n.data_tile)))).map((n,a)=>{let l=r[a];return{data:n,z:e,data_tile:l.data_tile,scale:l.scale,dim:l.dim,origin:l.origin}})})}getDisplayTile(e){return D(this,null,function*(){let i=this.dataTileForDisplayTile(e);return{data:yield this.tileCache.get(i.data_tile),z:e.z,data_tile:i.data_tile,scale:i.scale,origin:i.origin,dim:i.dim}})}queryFeatures(e,i,r){return this.tileCache.queryFeatures(e,i,Math.min(r-this.levelDiff,this.maxDataLevel))}};var vt=X(q());function Me(t,e,i,r,s,n,a,l){let o=performance.now();t.save(),t.miterLimit=2;for(var u of e){let g=u.origin,h=u.scale;t.save(),a&&(t.beginPath(),t.rect(g.x-n.x,g.y-n.y,u.dim,u.dim),t.clip()),t.translate(g.x-n.x,g.y-n.y);for(var d of r)if(!(d.minzoom&&u.z<d.minzoom)&&!(d.maxzoom&&u.z>d.maxzoom)){var x=u.data.get(d.dataLayer);if(x!==void 0){d.symbolizer.before(t,u.z);for(var m of x){let f=m.geom,c=m.bbox;if(c[2]*h+g.x<s[0]||c[0]*h+g.x>s[2]||c[1]*h+g.y>s[3]||c[3]*h+g.y<s[1])continue;let w=m.properties;d.filter&&!d.filter(w)||(h!=1&&(f=_e(f,h,new vt.default(0,0))),d.symbolizer.draw(t,f,w))}}}t.restore()}let p=i.searchBbox({minX:s[0],minY:s[1],maxX:s[2],maxY:s[3]},Infinity);for(var b of p){if(t.save(),t.translate(b.anchor.x-n.x,b.anchor.y-n.y),b.draw(t),l){t.lineWidth=.5,t.strokeStyle=l,t.fillStyle=l,t.globalAlpha=1,t.fillRect(-2,-2,4,4);for(let g of b.bboxes)t.strokeRect(g.minX-n.x,g.minY-n.y,g.maxX-g.minX,g.maxY-g.minY)}t.restore()}return t.restore(),performance.now()-o}var _t=X(Ft()),Ii=(t,e,i)=>{let r=256,s=e/r,n=Math.floor(i.minX/r),a=Math.floor(i.minY/r),l=Math.floor(i.maxX/r),o=Math.floor(i.maxY/r),u=Math.log2(s),d=[];for(let x=n;x<=l;x++)for(let m=a;m<=o;m++)d.push({display:W({z:t,x,y:m}),key:W({z:t-u,x:Math.floor(x/s),y:Math.floor(m/s)})});return d},Mt=class{constructor(){this.tree=new _t.default,this.current=new Map}has(e){return this.current.has(e)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(e,i){let r=new Set;for(let s of this.tree.search(e))s.indexed_label.order<=i&&r.add(s.indexed_label);return r}searchLabel(e,i){let r=new Set;for(let s of e.bboxes)for(let n of this.tree.search(s))n.indexed_label.order<=i&&r.add(n.indexed_label);return r}bboxCollides(e,i){for(let r of this.tree.search(e))if(r.indexed_label.order<=i)return!0;return!1}labelCollides(e,i){for(let r of e.bboxes)for(let s of this.tree.search(r))if(s.indexed_label.order<=i)return!0;return!1}insert(e,i,r){let s={anchor:e.anchor,bboxes:e.bboxes,draw:e.draw,order:i,tileKey:r};if(this.current.has(r))this.current.get(r).add(s);else{let a=new Set;a.add(s),this.current.set(r,a)}for(let a of e.bboxes){var n=a;n.indexed_label=s,this.tree.insert(n)}}prune(e){let i=this.current.get(e),r=[];for(let s of this.tree.all())i.has(s.indexed_label)&&r.push(s);r.forEach(s=>{this.tree.remove(s)}),this.current.delete(e)}removeLabel(e){let i=[];for(let r of this.tree.all())e==r.indexed_label&&i.push(r);i.forEach(r=>{this.tree.remove(r)}),this.current.get(e.tileKey).delete(e)}},Se=class{constructor(e,i,r,s){this.index=new Mt,this.z=e,this.scratch=i,this.labelRules=r,this.callback=s}layout(e){let i=performance.now(),r=W(e.data_tile),s=new Set;for(var[n,a]of this.labelRules.entries()){if(a.visible==!1||a.minzoom&&this.z<a.minzoom||a.maxzoom&&this.z>a.maxzoom)continue;let o=e.data.get(a.dataLayer);if(o===void 0)continue;let u=o;a.sort&&u.sort((d,x)=>a.sort(d.properties,x.properties));for(let d of u){if(a.filter&&!a.filter(d.properties))continue;let x=_e(d.geom,e.scale,e.origin),m=a.symbolizer.stash(this.index,n,this.scratch,x,d,this.z);if(!!m)for(let p of m){var l=!1;if(this.index.labelCollides(p,Infinity)){if(!this.index.labelCollides(p,n)){let b=this.index.searchLabel(p,Infinity);for(let g of b){this.index.removeLabel(g);for(let h of g.bboxes)this.findInvalidatedTiles(s,e.dim,h,r)}this.index.insert(p,n,r),l=!0}}else this.index.insert(p,n,r),l=!0;if(l)for(let b of p.bboxes)(b.maxX>e.origin.x+e.dim||b.minX<e.origin.x||b.minY<e.origin.y||b.maxY>e.origin.y+e.dim)&&this.findInvalidatedTiles(s,e.dim,b,r)}}}return s.size>0&&this.callback&&this.callback(s),performance.now()-i}findInvalidatedTiles(e,i,r,s){let n=Ii(this.z,i,r);for(let a of n)a.key!=s&&this.index.has(a.key)&&e.add(a.display)}pruneCache(e){if(this.index.size()>16){let i,r=0;for(let s of this.index.keys()){let n=s.split(":"),a=Math.sqrt(Math.pow(+n[0]-e.data_tile.x,2)+Math.pow(+n[1]-e.data_tile.y,2));a>r&&(r=a,i=s)}this.index.prune(i)}}add(e){let i=W(e.data_tile);if(this.index.has(i))return 0;{let r=this.layout(e);return this.pruneCache(e),r}}},Le=class{constructor(e,i,r){this.labelers=new Map,this.scratch=e,this.labelRules=i,this.callback=r}add(e){return this.labelers.get(e.z)||this.labelers.set(e.z,new Se(e.z,this.scratch,this.labelRules,this.callback)),this.labelers.get(e.z).add(e)}getIndex(e){return this.labelers.get(e).index}};var A=X(q());var Dt=X(kt());function We(t){if(t.length<=15)return[t];let e=t.lastIndexOf(" ",14),i=t.indexOf(" ",14);if(e==-1&&i==-1)return[t];let r,s;return i==-1||e>=0&&14-e<i-14?(r=t.substring(0,e),s=t.substring(e+1,t.length)):(r=t.substring(0,i),s=t.substring(i+1,t.length)),[r,...We(s)]}var qi="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",pr=new RegExp("^["+qi+"]+$");var N=class{constructor(e={}){this.properties=e.properties||["name"],this.textTransform=e.textTransform}str(e,i){var r;for(let s of this.properties)if(i.hasOwnProperty(s)){r=i[s];break}return r&&this.textTransform==="uppercase"&&(r=r.toUpperCase()),r}},j=class{constructor(e){e.font?this.font=e.font:(this.family=e.fontFamily||"sans-serif",this.size=e.fontSize||12,this.weight=e.fontWeight,this.style=e.fontStyle)}str(e,i){if(this.font)return typeof this.font=="function"?this.font(e,i):this.font;var r="";this.style&&(typeof this.style=="function"?r=this.style(e,i)+" ":r=this.style+" ");var s="";this.weight&&(typeof this.weight=="function"?s=this.weight(e,i)+" ":s=this.weight+" ");var n;typeof this.size=="function"?n=this.size(e,i):n=this.size;var a;return typeof this.family=="function"?a=this.family(e,i):a=this.family,`${r}${s}${n}px ${a}`}};var Bt=X(Tt());function Pt(t,e){let i,r,s=0;for(let n of t){let a=(0,Bt.default)(n,Math.PI/2/18);for(let l of a)l.length>=e&&l.length>s&&(s=l.length,i=n[l.beginIndex],r=n[l.endIndex-1])}if(!!i&&!(i.x==r.x&&i.y==r.y))return{start:i,end:r}}function Ct(t,e,i,r){let s=e.x-t.x,n=e.y-t.y,a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),l=[];for(var o=r;o<i;o+=2*r){let u=o*1/a;l.push({x:t.x+u*s,y:t.y+u*n})}return l}var Rt=(t,e,i)=>{let r=document.createElement("canvas"),s=r.getContext("2d");return r.width=t,r.height=e,i(r,s),r},B=class{constructor(e){this.fill=e.fill||"#000000",this.opacity=e.opacity||1,this.pattern=e.pattern}before(e){this.pattern?e.fillStyle=e.createPattern(this.pattern,"repeat"):e.fillStyle=this.fill,e.globalAlpha=this.opacity}draw(e,i,r){e.beginPath();for(var s of i)for(var n=0;n<s.length-1;n++){let a=s[n];n==0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}e.fill()}};function Vt(t,e){return i=>{let r=i-t;return r>=0&&r<e.length?e[r]:0}}function R(t,e){return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[e.length-1][0])return e[e.length-1][1];let r=0;for(;e[r+1][0]<i;)r++;let s=e[r+1][0]-e[r][0],n=i-e[r][0];var a;return s===0?a=0:t===1?a=n/s:a=(Math.pow(t,n)-1)/(Math.pow(t,s)-1),a*(e[r+1][1]-e[r][1])+e[r][1]}}function Ui(t){return!!(t&&t.constructor&&t.call&&t.apply)}var C=class{constructor(e){this.color=e.color||"#000000",this.width=e.width||1,this.opacity=e.opacity||1,this.skip=!1,this.dash=e.dash,this.dashColor=e.dashColor||"black",this.dashWidth=e.dashWidth||1}before(e,i){if(e.strokeStyle=this.color,e.globalAlpha=this.opacity,Ui(this.width)&&this.width.length==1){let r=this.width(i);this.skip=r===0,e.lineWidth=r}else e.lineWidth=this.width}draw(e,i,r){if(!this.skip){e.beginPath();for(var s of i)for(var n=0;n<s.length;n++){let a=s[n];n==0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}this.dash?(e.save(),e.lineWidth=this.dashWidth,e.strokeStyle=this.dashColor,e.setLineDash(this.dash),e.stroke(),e.restore()):e.stroke()}}},Oe=class{constructor(e){this.sprites=e.sprites,this.name=e.name}stash(e,i,r,s,n,a){let l=s[0],o=new A.default(s[0][0].x,s[0][0].y),u={minX:o.x-32,minY:o.y-32,maxX:o.x+32,maxY:o.y+32};return[{anchor:o,bboxes:[u],draw:x=>{x.globalAlpha=1;let m=this.sprites.get(this.name);x.drawImage(m.canvas,m.x,m.y,m.w,m.h,-8,-8,m.w,m.h)}}]}},ne=class{constructor(e){this.radius=e.radius||3,this.fill=e.fill||"black",this.stroke=e.stroke||"white",this.width=e.width||0}stash(e,i,r,s,n,a){let l=s[0],o=new A.default(s[0][0].x,s[0][0].y),u={minX:o.x-this.radius,minY:o.y-this.radius,maxX:o.x+this.radius,maxY:o.y+this.radius};return[{anchor:o,bboxes:[u],draw:x=>{x.globalAlpha=1,this.width>0&&(x.fillStyle=this.stroke,x.beginPath(),x.arc(0,0,this.radius+this.width,0,2*Math.PI),x.fill()),x.fillStyle=this.fill,x.beginPath(),x.arc(0,0,this.radius,0,2*Math.PI),x.fill()}}]}},$e=class{constructor(e){this.font=new j(e),this.text=new N(e),this.fill=e.fill||"black",this.stroke=e.stroke||"white",this.background=e.background||"white",this.padding=e.padding||0}stash(e,i,r,s,n,a){let l=this.text.str(a,n.properties);if(!l)return;let o=this.font.str(a,n.properties);r.font=o;let u=r.measureText(l),d=u.width,x=u.actualBoundingBoxAscent,m=u.actualBoundingBoxDescent,p=s[0],b=new A.default(s[0][0].x,s[0][0].y),g=this.padding,h={minX:b.x-d/2-g,minY:b.y-x-g,maxX:b.x+d/2+g,maxY:b.y+m+g};return[{anchor:b,bboxes:[h],draw:c=>{c.globalAlpha=1,c.fillStyle=this.background,c.fillRect(-d/2-g,-x-g,d+2*g,x+m+2*g),c.fillStyle=this.fill,c.font=o,c.fillText(l,-d/2,0)}}]}};var Zi=(t,e)=>({minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}),se=class{constructor(e){this.list=e}stash(e,i,r,s,n,a){var l=this.list[0].stash(e,i,r,s,n,a),o=l[0];let u=o.anchor,d=o.bboxes[0],x=[o.draw];for(let p=1;p<this.list.length;p++){if(l=this.list[p].stash(e,i,r,s,n,a),!l)return;o=l[0],d=Zi(d,o.bboxes[0]),x.push(o.draw)}return[{anchor:u,bboxes:[d],draw:p=>{x.forEach(b=>b(p))}}]}},Y=class{constructor(e){this.font=new j(e),this.text=new N(e),this.fill=e.fill,this.stroke=e.stroke||"black",this.width=e.width||0}stash(e,i,r,s,n,a){if(n.geomType!==fe.Point)return;let l=this.text.str(a,n.properties);if(!l)return;let o=this.font.str(a,n.properties);r.font=o;let u=r.measureText(l),d=u.width,x=u.actualBoundingBoxAscent,m=u.actualBoundingBoxDescent,p=new A.default(s[0][0].x,s[0][0].y),b={minX:p.x-d/2,minY:p.y-x,maxX:p.x+d/2,maxY:p.y+m},g=-d/2;return[{anchor:p,bboxes:[b],draw:f=>{f.globalAlpha=1,f.font=o,this.width&&(f.lineWidth=this.width*2,f.strokeStyle=this.stroke,f.strokeText(l,g,0)),f.fillStyle=this.fill,f.fillText(l,g,0)}}]}},ae=class{constructor(e){this.font=new j(e),this.text=new N(e),this.fill=e.fill,this.stroke=e.stroke||"black",this.width=e.width||0,this.offset=e.offset||0}stash(e,i,r,s,n,a){if(n.geomType!==fe.Point)return;let l=this.text.str(a,n.properties);if(!l)return;let o=this.font.str(a,n.properties);r.font=o;let u=r.measureText(l),d=u.width,x=u.actualBoundingBoxAscent,m=u.actualBoundingBoxDescent,p=new A.default(s[0][0].x,s[0][0].y),b=this.offset;var g=new A.default(b,-b);let h=c=>{c.globalAlpha=1,c.font=o,this.width&&(c.lineWidth=this.width*2,c.strokeStyle=this.stroke,c.strokeText(l,g.x,g.y)),c.fillStyle=this.fill,c.fillText(l,g.x,g.y)};var f={minX:p.x+g.x,minY:p.y-x+g.y,maxX:p.x+d+g.x,maxY:p.y+m+g.y};if(!e.bboxCollides(f,i))return[{anchor:p,bboxes:[f],draw:h}];if(g=new A.default(-d-b,-b),f={minX:p.x+g.x,minY:p.y-x+g.y,maxX:p.x+d+g.x,maxY:p.y+m+g.y},!e.bboxCollides(f,i))return[{anchor:p,bboxes:[f],draw:h}]}},G=class{constructor(e){this.font=new j(e),this.text=new N(e),this.fill=e.fill||"black",this.stroke=e.stroke||"black",this.width=e.width||0,this.offset=e.offset||0}stash(e,i,r,s,n,a){let l=this.text.str(a,n.properties);if(!l||l.length>20)return;let o=n.bbox;if((o[3]-o[1])*(o[2]-o[0])<100)return;let d=this.font.str(a,n.properties);r.font=d;let m=r.measureText(l).width,p=Pt(s,m);if(!p)return;let b=p.end.x-p.start.x,g=p.end.y-p.start.y,h=8,c=Ct(p.start,p.end,m,8).map(y=>({minX:y.x-h,minY:y.y-h,maxX:y.x+h,maxY:y.y+h})),w=y=>{y.globalAlpha=1,y.rotate(Math.atan2(g,b)),b<0&&(y.scale(-1,-1),y.translate(-m,0)),y.translate(0,-this.offset),y.font=d,this.width&&(y.lineWidth=this.width,y.strokeStyle=this.stroke,y.strokeText(l,0,0)),y.fillStyle=this.fill,y.fillText(l,0,0)};return[{anchor:p.start,bboxes:c,draw:w}]}},H=class{constructor(e){this.font=new j(e),this.text=new N(e),this.fill=e.fill||"black",this.stroke=e.stroke||"black",this.width=e.width||0}stash(e,i,r,s,n,a){let l=n.bbox;if((l[3]-l[1])*(l[2]-l[0])<2e4)return[];let u=this.text.str(a,n.properties);if(!u)return;let d=s[0],x=(0,Dt.default)([d.map(_=>[_.x,_.y])]),m=new A.default(x[0],x[1]),p=this.font.str(a,n.properties);r.font=p;let b=We(u),g=14;var h,f=0;for(let _ of b)_.length>f&&(f=_.length,h=_);let c=r.measureText(h),w=c.width,y={minX:m.x-w/2,minY:m.y-c.actualBoundingBoxAscent,maxX:m.x+w/2,maxY:m.y+(g*b.length-c.actualBoundingBoxAscent)},v=this.fill;return[{anchor:m,bboxes:[y],draw:_=>{_.globalAlpha=1,_.font=p;var M=0;for(let S of b)this.width&&(_.lineWidth=this.width,_.strokeStyle=this.stroke,_.strokeText(S,-w/2,M)),_.fillStyle=v,_.fillText(S,-w/2,M),M+=g}}]}};var ze=t=>[{dataLayer:"earth",symbolizer:new B({fill:t.earth})},{dataLayer:"natural",symbolizer:new B({fill:t.glacier}),filter:e=>e.natural=="glacier"},{dataLayer:"landuse",symbolizer:new B({fill:t.residential}),filter:e=>e.landuse=="residential"||e.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new B({fill:t.hospital}),filter:e=>e.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new B({fill:t.cemetery}),filter:e=>e.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new B({fill:t.school}),filter:e=>e.amenity=="school"||e.amenity=="kindergarten"||e.amenity=="university"||e.amenity=="college"},{dataLayer:"landuse",symbolizer:new B({fill:t.industrial}),filter:e=>e.landuse=="industrial"},{dataLayer:"natural",symbolizer:new B({fill:t.wood}),filter:e=>e.natural=="wood"},{dataLayer:"landuse",symbolizer:new B({fill:t.grass}),filter:e=>e.landuse=="grass"},{dataLayer:"landuse",symbolizer:new B({fill:t.park}),filter:e=>e.leisure=="park"},{dataLayer:"water",symbolizer:new B({fill:t.water})},{dataLayer:"natural",symbolizer:new B({fill:t.sand}),filter:e=>e.natural=="sand"},{dataLayer:"buildings",symbolizer:new B({fill:t.buildings})},{dataLayer:"roads",symbolizer:new C({color:t.highwayCasing,width:R(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:e=>e["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new C({color:t.majorRoadCasing,width:R(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:e=>e["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new C({color:t.mediumRoadCasing,width:R(1.4,[[13,3],[17,6],[20,18]])}),filter:e=>e["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new C({color:t.minorRoadCasing,width:R(1.4,[[14,2],[17,5],[20,15]])}),filter:e=>e["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new C({color:t.minorRoad,width:R(1.4,[[14,1],[17,3],[20,13]])}),filter:e=>e["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new C({color:t.mediumRoad,width:R(1.4,[[13,2],[17,4],[20,15]])}),filter:e=>e["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new C({color:t.majorRoad,width:R(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:e=>e["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new C({color:t.highway,width:R(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:e=>e["pmap:kind"]=="highway"},{dataLayer:"boundaries",symbolizer:new C({color:t.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new B({fill:t.mask})}],Te=t=>[{dataLayer:"places",symbolizer:new Y({fill:t.countryLabel,font:(e,i)=>e<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),filter:e=>e["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:new Y({fill:t.stateLabel,font:"300 16px sans-serif"}),filter:e=>e["pmap:kind"]=="state"},{dataLayer:"places",filter:e=>e["pmap:kind"]=="city",minzoom:7,symbolizer:new Y({fill:t.cityLabel,font:(e,i)=>i["pmap:rank"]==1?e>8?"600 20px sans-serif":"600 12px sans-serif":e>8?"600 16px sans-serif":"600 10px sans-serif"}),sort:(e,i)=>e["pmap:rank"]-i["pmap:rank"]},{dataLayer:"places",filter:e=>e["pmap:kind"]=="city",maxzoom:6,symbolizer:new se([new ne({radius:2,fill:t.cityLabel}),new ae({fill:t.cityLabel,offset:2,font:(e,i)=>i["pmap:rank"]==1?e>8?"600 20px sans-serif":"600 12px sans-serif":e>8?"600 16px sans-serif":"600 10px sans-serif"})]),sort:(e,i)=>e["pmap:rank"]-i["pmap:rank"]},{dataLayer:"places",symbolizer:new Y({fill:t.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),filter:e=>e["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:new H({fill:t.landuseLabel,font:"300 12px sans-serif"})},{dataLayer:"water",symbolizer:new H({fill:t.waterLabel,font:"italic 600 12px sans-serif"})},{dataLayer:"natural",symbolizer:new H({fill:t.naturalLabel,font:"italic 300 12px sans-serif"})},{dataLayer:"roads",symbolizer:new G({fill:t.roadsLabel,font:"500 12px sans-serif"}),minzoom:12},{dataLayer:"roads",symbolizer:new $e({properties:["ref"],font:"600 9px sans-serif",background:t.highway,padding:2,fill:"#999"}),filter:e=>e["pmap:kind"]=="highway"},{dataLayer:"pois",symbolizer:new se([new ne({radius:2,fill:t.poisLabel}),new ae({fill:t.poisLabel,offset:2,font:"300 10px sans-serif"})])}];var It={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"},xe=ze(It),pe=Te(It);var Ne=6378137,Xt=85.0511287798,Pe=Ne*Math.PI,Wi=t=>{let e=Math.PI/180,i=Math.max(Math.min(Xt,t[0]),-Xt),r=Math.sin(i*e);return new Be.default(Ne*t[1]*e,Ne*Math.log((1+r)/(1-r))/2)},je=class{constructor(e){this.paint_rules=e.paint_rules||xe,this.label_rules=e.label_rules||pe;let i;e.url.url?i=new O(e.url):e.url.endsWith(".pmtiles")?i=new O(e.url):i=new de(e.url);let r=new ce(i,1024);this.view=new me(r,14,2),this.debug=e.debug||!1}drawContext(e,i,r,s,n){return D(this,null,function*(){let a=Wi(s),o=new Be.default((a.x+Pe)/(Pe*2),1-(a.y+Pe)/(Pe*2)).clone().mult((1<<n)*256).sub(new Be.default(i/2,r/2)),u=[o.x,o.y,o.x+i,o.y+r],d=yield this.view.getBbox(n,u),x=performance.now(),m=new Se(n,e,this.label_rules,null);for(var p of d)yield m.add(p);let b=Me(e,d,m.index,this.paint_rules,u,o,!0,this.debug);if(this.debug){e.save(),e.translate(-o.x,-o.y);for(var p of d)e.strokeStyle="black",e.strokeRect(p.origin.x,p.origin.y,p.dim,p.dim);e.restore()}return performance.now()-x})}drawCanvas(e,i,r){return D(this,null,function*(){let s=window.devicePixelRatio,n=e.clientWidth,a=e.clientHeight;e.width=n*s,e.height=a*s;let l=e.getContext("2d");return l.scale(s,s),this.drawContext(l,n,a,i,r)})}};var Et=X(q());var Yt={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"},Ge=ze(Yt),He=Te(Yt);var At=class{constructor(e){this.lang=e,this.unused=[]}get(e){if(this.unused.length){let r=this.unused.shift();return r.removed=!1,r}let i=L.DomUtil.create("canvas","leaflet-tile");return i.width=e,i.height=e,i.lang=this.lang,i}put(e){L.DomUtil.removeClass(e,"leaflet-tile-loaded"),this.unused.push(e)}},Oi=t=>new Promise((e,i)=>{setTimeout(()=>{e()},t)}),Ce=class extends L.GridLayer{constructor(e){e.noWrap&&!e.bounds&&(e.bounds=[[-90,-180],[90,180]]),super(e),this.paint_rules=e.paint_rules||(e.dark?Ge:xe),this.label_rules=e.label_rules||(e.dark?He:pe),this.lastRequestedZ=void 0;let i;e.url.url?i=new O(e.url):e.url.endsWith(".pmtiles")?i=new O(e.url):i=new de(e.url),this.tasks=e.tasks||[];let r=new ce(i,1024);this.view=new me(r,14,2),this.debug=e.debug;let s=document.createElement("canvas").getContext("2d");this.scratch=s,this.onTilesInvalidated=n=>{n.forEach(a=>{this.rerenderTile(a)})},this.labelers=new Le(this.scratch,this.label_rules,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.pool=new At(e.lang)}setDefaultStyle(e){this.paint_rules=e?Ge:xe,this.label_rules=e?He:pe}renderTile(e,i,r,s=()=>{}){return D(this,null,function*(){this.lastRequestedZ=e.z;var n;try{n=yield this.view.getDisplayTile(e)}catch(c){if(c.name=="AbortError")return;throw c}if(i.key!=r||this.lastRequestedZ!==e.z||(yield Promise.allSettled(this.tasks),i.key!=r)||this.lastRequestedZ!==e.z)return;let a=yield this.labelers.add(n);if(i.key!=r||this.lastRequestedZ!==e.z)return;let l=this.labelers.getIndex(n.z);if(!this._map)return;let o=this._map.getCenter().wrap(),u=this._getTiledPixelBounds(o),d=this._pxBoundsToTileRange(u),x=d.getCenter(),m=e.distanceTo(x)*5;if(yield Oi(m),i.key!=r||this.lastRequestedZ!==e.z)return;let p=16,b=[256*e.x-p,256*e.y-p,256*(e.x+1)+p,256*(e.y+1)+p],g=new Et.default(256*e.x,256*e.y),h=i.getContext("2d");h.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),h.clearRect(0,0,256,256);let f=Me(h,[n],l,this.paint_rules,b,g,!1,this.debug);if(this.debug){let c=n.data_tile;h.save(),h.fillStyle=this.debug,h.font="600 12px sans-serif",h.fillText(e.z+" "+e.x+" "+e.y,4,14),h.font="200 12px sans-serif",(c.x%2+c.y%2)%2==0&&(h.font="200 italic 12px sans-serif"),h.fillText(c.z+" "+c.x+" "+c.y,4,28),h.font="600 10px sans-serif",f>8&&h.fillText(f.toFixed()+" ms paint",4,42),a>8&&h.fillText(a.toFixed()+" ms layout",4,56),h.strokeStyle=this.debug,h.lineWidth=.5,h.strokeRect(0,0,256,256),h.restore()}s()})}rerenderTile(e){for(let i in this._tiles){let r=this._wrapCoords(this._keyToTileCoords(i));e===this._tileCoordsToKey(r)&&this.renderTile(r,this._tiles[i].el,e)}}clearLayout(){this.labelers=new Le(this.scratch,this.label_rules,this.onTilesInvalidated)}rerenderTiles(){for(let e in this._tiles){let i=this._wrapCoords(this._keyToTileCoords(e)),r=this._tileCoordsToKey(i);this.renderTile(i,this._tiles[e].el,r)}}createTile(e,i){let r=this.pool.get(this.tile_size),s=this._tileCoordsToKey(e);return r.key=s,this.renderTile(e,r,s,()=>{i(null,r)}),r}_removeTile(e){let i=this._tiles[e];!i||(i.el.removed=!0,i.el.key=void 0,L.DomUtil.remove(i.el),this.pool.put(i.el),delete this._tiles[e],this.fire("tileunload",{tile:i.el,coords:this._keyToTileCoords(e)}))}queryFeatures(e,i){return this.view.queryFeatures(e,i,this._map.getZoom())}},qt=t=>new Ce(t);function Qe(t){if(t.includes("$type"))return e=>!0;if(t[0]=="==")return e=>e[t[1]]===t[2];if(t[0]=="!=")return e=>e[t[1]]!==t[2];if(t[0]==="<")return e=>e[t[1]]<t[2];if(t[0]===">")return e=>e[t[1]]>t[2];if(t[0]==="in")return e=>t.slice(2,t.length).includes(e[t[1]]);if(t[0]==="!in")return e=>!t.slice(2,t.length).includes(e[t[1]]);if(t[0]==="has")return e=>e.hasOwnProperty(t[1]);if(t[0]==="all"){let e=t.slice(1,t.length).map(i=>Qe(i));return i=>e.every(r=>r(i))}else if(t[0]==="any"){let e=t.slice(1,t.length).map(i=>Qe(i));return i=>e.some(r=>r(i))}else console.log("Unimplemented filter: ",t[0])}function Je(t){if(t.base&&t.stops)return(i,r)=>R(t.base,t.stops)(i-1);if(t[0]=="interpolate"&&t[1][0]=="exponential"&&t[2]=="zoom"){let i=t.slice(3),r=[];for(var e=0;e<i.length;e+=2)r.push([i[e],i[e+1]]);return s=>R(t[1][1],r)(s-1)}else if(t[0]=="step"&&t[1][0]=="get"){let i=t.slice(2),r=t[1][1];return(s,n)=>{let a=n[r];if(a<i[1])return i[0];for(e=1;e<i.length;e+=2)if(a<=i[e])return i[e+1];return i[i.length-1]}}else console.log("Unimplemented numeric fn: ",t)}function Ut(t,e=0){return t?typeof t=="number"?t:Je(t):e}function Zt(t,e){let i=Ut(t,1),r=Ut(e);return s=>{let n=typeof i=="number"?i:i(s,{});return r?n+(typeof r=="number"?r:r(s,{})):n}}function Wt(t,e){let i=[];for(let l of t["text-font"])e.hasOwnProperty(l)&&i.push(e[l]);i.length===0&&i.push({face:"sans-serif"});let r=t["text-size"];var s="";i.length&&i[0].weight&&(s=i[0].weight+" ");var n="";if(i.length&&i[0].style&&(n=i[0].style+" "),typeof r=="number")return`${n}${s}${r}px ${i.map(l=>l.face).join(", ")}`;if(r.stops){var a=1.4;r.base&&(a=r.base);let l=Je(r);return o=>`${n}${s}${l(o,{})}px ${i.map(u=>u.face).join(", ")}`}else if(r[0]=="step"){let l=Je(r);return(o,u)=>`${n}${s}${l(o,u)}px ${i.map(d=>d.face).join(", ")}`}else console.log("Can't parse font: ",t)}function Ot(t,e){let i=[],r=[],s=new Map;for(var n of t.layers){if(s.set(n.id,n),n.layout&&n.layout.visibility=="none")continue;if(n.ref){let u=s.get(n.ref);n.type=u.type,n.filter=u.filter,n.source=u.source,n["source-layer"]=u["source-layer"]}let o=n["source-layer"];var a,l=void 0;n.filter&&(l=Qe(n.filter)),n.type=="fill"?i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new B({fill:n.paint["fill-color"],opacity:n.paint["fill-opacity"]})}):n.type=="fill-extrusion"?i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new B({fill:n.paint["fill-extrusion-color"],opacity:n.paint["fill-extrusion-opacity"]})}):n.type=="line"?n.paint["line-dasharray"]?i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new C({width:Zt(n.paint["line-width"],n.paint["line-gap-width"]),dash:n.paint["line-dasharray"],dashColor:n.paint["line-color"]})}):i.push({dataLayer:n["source-layer"],filter:l,symbolizer:new C({color:n.paint["line-color"],width:Zt(n.paint["line-width"],n.paint["line-gap-width"])})}):n.type=="symbol"&&(n.layout["symbol-placement"]=="line"?r.push({dataLayer:n["source-layer"],filter:l,symbolizer:new G({font:Wt(n.layout,e),fill:n.paint["text-color"],width:n.paint["text-halo-width"],stroke:n.paint["text-halo-color"],textTransform:n.layout["text-transform"]})}):r.push({dataLayer:n["source-layer"],filter:l,symbolizer:new Y({font:Wt(n.layout,e),fill:n.paint["text-color"],stroke:n.paint["text-halo-color"],width:n.paint["text-halo-width"],textTransform:n.layout["text-transform"]})}))}return r.reverse(),{paint_rules:i,label_rules:r,tasks:[]}}var $i=t=>{let e=0,i=0;for(let l of t)e+=l.w*l.h,i=Math.max(i,l.w);t.sort((l,o)=>o.h-l.h);let r=Math.max(Math.ceil(Math.sqrt(e/.95)),i),s=[{x:0,y:0,w:r,h:Infinity}],n=0,a=0;for(let l of t)for(let o=s.length-1;o>=0;o--){let u=s[o];if(!(l.w>u.w||l.h>u.h)){if(l.x=u.x,l.y=u.y,a=Math.max(a,l.y+l.h),n=Math.max(n,l.x+l.w),l.w===u.w&&l.h===u.h){let d=s.pop();o<s.length&&(s[o]=d)}else l.h===u.h?(u.x+=l.w,u.w-=l.w):l.w===u.w?(u.y+=l.h,u.h-=l.h):(s.push({x:u.x+l.w,y:u.y,w:u.w-l.w,h:l.h}),u.y+=l.h,u.h-=l.h);break}}return{w:n,h:a,fill:e/(n*a)||0}},$t=t=>new Promise((e,i)=>{let r=new Image;r.onload=()=>e(r),r.onerror=()=>i("Invalid SVG"),r.src=t}),Ni=`
<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <rect width="50" height="50" fill="#cccccc"/>
    <g transform="translate(5,5)">
        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>
    </g>
</svg>
`,De=class{constructor(e){this.src=e,this.canvas=null}load(){return D(this,null,function*(){let e=this.src,i=window.devicePixelRatio;e.endsWith(".html")&&(e=yield(yield fetch(e)).text());let s=new window.DOMParser().parseFromString(e,"text/html").body.children;this.mapping={};let n=yield $t("data:image/svg+xml;base64,"+btoa(Ni)),a=[{w:n.width*i,h:n.height*i,img:n}],l=new XMLSerializer;for(let m of s){var o=btoa(l.serializeToString(m)),u="data:image/svg+xml;base64,"+o;let p=yield $t(u);a.push({w:p.width*i,h:p.height*i,img:p,id:m.id})}let d=$i(a);this.canvas=document.createElement("canvas"),this.canvas.width=d.w,this.canvas.height=d.h;let x=this.canvas.getContext("2d");for(let m of a)x.drawImage(m.img,m.x,m.y,m.w,m.h),m.id?this.mapping[m.id]={x:m.x,y:m.y,w:m.w,h:m.h}:this.missingBox={x:m.x,y:m.y,w:m.w,h:m.h};return this})}get(e){let i=this.mapping[e];return i||(i=this.missingBox),i.canvas=this.canvas,i}};var Nt=(t,e,i)=>{let r=new FontFace(t,"url("+e+")",{weight:i});return document.fonts.add(r),r.load()},jt=t=>new De(t);return ji;})();
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
